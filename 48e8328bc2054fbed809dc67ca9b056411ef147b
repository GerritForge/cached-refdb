{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "be12b64f_1e93be68",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/CachedRefDatabase.java",
        "patchSetId": 49
      },
      "lineNbr": 166,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:47:06Z",
      "side": 1,
      "message": "If we log `atSevere()` means that the operation failed, and we should throw an exception.\n\nIn the code we fallback to the delegate, hence we should log this as a warning.\n\n\n\n```suggestion\n      logger.atWarning().withCause(e).log(\n```",
      "range": {
        "startLine": 166,
        "startChar": 13,
        "endLine": 166,
        "endChar": 21
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "079a32f2_4e64a79e",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/CachedRefDatabase.java",
        "patchSetId": 49
      },
      "lineNbr": 166,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:51:36Z",
      "side": 1,
      "message": "Fix applied.",
      "parentUuid": "be12b64f_1e93be68",
      "range": {
        "startLine": 166,
        "startChar": 13,
        "endLine": 166,
        "endChar": 21
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6c2f6671_4ee73ec6",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/CachedRefDatabase.java",
        "patchSetId": 49
      },
      "lineNbr": 185,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:47:06Z",
      "side": 1,
      "message": "I believe we should do the other way around: implement a get by list of prefixes at the lower level and then have the getRefsByPrefix(prefix) delegate to this one.",
      "range": {
        "startLine": 183,
        "startChar": 0,
        "endLine": 185,
        "endChar": 5
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "36013c73_4b7d0804",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/CachedRefDatabase.java",
        "patchSetId": 49
      },
      "lineNbr": 185,
      "author": {
        "id": 1012541
      },
      "writtenOn": "2026-02-23T19:49:04Z",
      "side": 1,
      "message": "Happy to do in a followup",
      "parentUuid": "6c2f6671_4ee73ec6",
      "range": {
        "startLine": 183,
        "startChar": 0,
        "endLine": 185,
        "endChar": 5
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7ec18016_c226be53",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/NoOpRefByNameCache.java",
        "patchSetId": 49
      },
      "lineNbr": 56,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:47:06Z",
      "side": 1,
      "message": "Why not re-throwing as an ExecutionException here?",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 56,
        "endChar": 23
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ddb48161_eedac0d7",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/NoOpRefByNameCache.java",
        "patchSetId": 49
      },
      "lineNbr": 56,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:51:36Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7ec18016_c226be53",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 56,
        "endChar": 23
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "86d45687_cc3194ac",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/NoOpRefByNameCache.java",
        "patchSetId": 49
      },
      "lineNbr": 66,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:47:06Z",
      "side": 1,
      "message": "Why not re-throwing as an ExecutionException here?",
      "range": {
        "startLine": 65,
        "startChar": 0,
        "endLine": 66,
        "endChar": 23
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "165e766c_15f8f0b3",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/NoOpRefByNameCache.java",
        "patchSetId": 49
      },
      "lineNbr": 66,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:51:36Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "86d45687_cc3194ac",
      "range": {
        "startLine": 65,
        "startChar": 0,
        "endLine": 66,
        "endChar": 23
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3453fe45_d5266e21",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/RefByNameCache.java",
        "patchSetId": 49
      },
      "lineNbr": 39,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:47:06Z",
      "side": 1,
      "message": "There\u0027s no need to have a default implementation here: all the implementations of this interface have a body.\n\n\n\n```suggestion\n  void updateRefNamesByProjectCache(String identifier, String refName);\n  \n  void evictFromRefNamesByProjectCache(String identifier, String refName);\n```",
      "range": {
        "startLine": 33,
        "startChar": 0,
        "endLine": 39,
        "endChar": 3
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "403b0aef_c037b3ff",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/RefByNameCache.java",
        "patchSetId": 49
      },
      "lineNbr": 39,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:51:36Z",
      "side": 1,
      "message": "Fix applied.",
      "parentUuid": "3453fe45_d5266e21",
      "range": {
        "startLine": 33,
        "startChar": 0,
        "endLine": 39,
        "endChar": 3
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c8b80e0_d21ad898",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/RefByNameCacheImpl.java",
        "patchSetId": 49
      },
      "lineNbr": 59,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:47:06Z",
      "side": 1,
      "message": "Why do we need an `AtomicReference\u003c\u003e` here? The cache already assures that we have one object per entry and it won\u0027t be changed concurrently because the cache has a locking mechanism associated with the entries.",
      "range": {
        "startLine": 59,
        "startChar": 46,
        "endLine": 59,
        "endChar": 61
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1ee19cf5_35333769",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/RefByNameCacheImpl.java",
        "patchSetId": 49
      },
      "lineNbr": 59,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:51:36Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3c8b80e0_d21ad898",
      "range": {
        "startLine": 59,
        "startChar": 46,
        "endLine": 59,
        "endChar": 61
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "20ba518a_f5deabb1",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/RefByNameCacheImpl.java",
        "patchSetId": 49
      },
      "lineNbr": 86,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:47:06Z",
      "side": 1,
      "message": "Missing `@Override`\n\n\n\n```suggestion\n    @Override\n    public AtomicReference\u003cTernarySearchTree\u003cObject\u003e\u003e load(Project.NameKey key) throws Exception {\n```",
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "65d2540c_bee00a58",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/RefByNameCacheImpl.java",
        "patchSetId": 49
      },
      "lineNbr": 86,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:51:36Z",
      "side": 1,
      "message": "Fix applied.",
      "parentUuid": "20ba518a_f5deabb1",
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "adbbf675_25825bd4",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/RefByNameCacheImpl.java",
        "patchSetId": 49
      },
      "lineNbr": 91,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:47:06Z",
      "side": 1,
      "message": "nit: this can be inlined.\n\n\n\n```suggestion\n        for (Ref ref : repo.getRefDatabase().getRefs()) {\n```",
      "range": {
        "startLine": 90,
        "startChar": 0,
        "endLine": 91,
        "endChar": 33
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "60488be3_84999d1a",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/RefByNameCacheImpl.java",
        "patchSetId": 49
      },
      "lineNbr": 91,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:51:36Z",
      "side": 1,
      "message": "Fix applied.",
      "parentUuid": "adbbf675_25825bd4",
      "range": {
        "startLine": 90,
        "startChar": 0,
        "endLine": 91,
        "endChar": 33
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "16aea53f_ea23f008",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/RefByNameCacheImpl.java",
        "patchSetId": 49
      },
      "lineNbr": 95,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:47:06Z",
      "side": 1,
      "message": "`ref` cannot be null.\n\n\n\n```suggestion\n            refByName.put(uniqueName, Optional.of(ref));\n```",
      "range": {
        "startLine": 95,
        "startChar": 47,
        "endLine": 95,
        "endChar": 57
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6e5c3f9d_e6750964",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/RefByNameCacheImpl.java",
        "patchSetId": 49
      },
      "lineNbr": 95,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:51:36Z",
      "side": 1,
      "message": "Fix applied.",
      "parentUuid": "16aea53f_ea23f008",
      "range": {
        "startLine": 95,
        "startChar": 47,
        "endLine": 95,
        "endChar": 57
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "02b84dae_37c9c104",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/RefRenameWithCacheUpdate.java",
        "patchSetId": 49
      },
      "lineNbr": 100,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:47:06Z",
      "side": 1,
      "message": "Why do we need to make two evictions, one byNameCache and another byRefNamesByProject? I believe you should always do both, isn\u0027t it? Why not just leaving the refsCache doing both for us?",
      "range": {
        "startLine": 96,
        "startChar": 0,
        "endLine": 100,
        "endChar": 83
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d2270c84_dcad2644",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/RefRenameWithCacheUpdate.java",
        "patchSetId": 49
      },
      "lineNbr": 100,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-22T23:15:50Z",
      "side": 1,
      "message": "Now that the names are more explicit, I believe it is clearer that they need to be unified.\n\nWhen deleting a ref, it should happen in both caches. When updating a ref, it should happen in both caches.\n\nHowever, I believe we should have a `rename` method because if we have a request between the deletion and the insertion, the ref would appear as it was removed, not renamed.\n\nThe rename should also be atomic at the cache level.",
      "parentUuid": "02b84dae_37c9c104",
      "range": {
        "startLine": 96,
        "startChar": 0,
        "endLine": 100,
        "endChar": 83
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e523defe_03a3380b",
        "filename": "src/main/java/com/gerritforge/gerrit/plugins/cachedrefdb/RefRenameWithCacheUpdate.java",
        "patchSetId": 49
      },
      "lineNbr": 100,
      "author": {
        "id": 1012541
      },
      "writtenOn": "2026-02-23T19:40:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d2270c84_dcad2644",
      "range": {
        "startLine": 96,
        "startChar": 0,
        "endLine": 100,
        "endChar": 83
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3327b3f3_0f35b946",
        "filename": "src/test/java/com/gerritforge/gerrit/plugins/cachedrefdb/CachedRefDbIT.java",
        "patchSetId": 49
      },
      "lineNbr": 101,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:47:06Z",
      "side": 1,
      "message": "We should also assert that the SHA1 of the `exactRef` corresponds to the one of the branch just created.",
      "range": {
        "startLine": 101,
        "startChar": 0,
        "endLine": 101,
        "endChar": 21
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "32cb8bea_66ae5ab3",
        "filename": "src/test/java/com/gerritforge/gerrit/plugins/cachedrefdb/CachedRefDbIT.java",
        "patchSetId": 49
      },
      "lineNbr": 101,
      "author": {
        "id": 1012541
      },
      "writtenOn": "2026-02-23T19:40:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3327b3f3_0f35b946",
      "range": {
        "startLine": 101,
        "startChar": 0,
        "endLine": 101,
        "endChar": 21
      },
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2fa308c8_01863208",
        "filename": "src/test/java/com/gerritforge/gerrit/plugins/cachedrefdb/CachedRefDbIT.java",
        "patchSetId": 49
      },
      "lineNbr": 106,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2026-02-21T04:47:06Z",
      "side": 1,
      "message": "As above, we should also check the associated SHA1.",
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b0950986_63754cb6",
        "filename": "src/test/java/com/gerritforge/gerrit/plugins/cachedrefdb/CachedRefDbIT.java",
        "patchSetId": 49
      },
      "lineNbr": 106,
      "author": {
        "id": 1012541
      },
      "writtenOn": "2026-02-23T19:40:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2fa308c8_01863208",
      "revId": "48e8328bc2054fbed809dc67ca9b056411ef147b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}